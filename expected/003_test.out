-- Should return a single job for public.t1
SELECT target, invocation FROM plan('{public.t1}');
  target   |    invocation     
-----------+-------------------
 public.t1 | CALL fdw.copy(7);
(1 row)

SELECT stage_id, job_id, config_id, lastseq, rows, state
  FROM job WHERE stage_id = 3;
 stage_id | job_id | config_id | lastseq | rows |  state  
----------+--------+-----------+---------+------+---------
        3 |      7 |         1 |       0 |    0 | pending
(1 row)

-- Should return all jobs
SELECT target, invocation FROM plan();
  target   |     invocation     
-----------+--------------------
 public.t2 | CALL fdw.copy(8);
 public.t2 | CALL fdw.copy(9);
 public.t1 | CALL fdw.copy(10);
(3 rows)

SELECT stage_id, job_id, config_id, lastseq, rows, state
  FROM job WHERE stage_id = 4;
 stage_id | job_id | config_id | lastseq | rows |  state  
----------+--------+-----------+---------+------+---------
        4 |      8 |         2 |    2000 |    0 | pending
        4 |      9 |         3 |    1999 |    0 | pending
        4 |     10 |         1 |       0 |    0 | pending
(3 rows)

-- Should fail as the table does not exist
SELECT target, invocation FROM plan('{public.foo}');
ERROR:  relation "public.foo" does not exist
CONTEXT:  SQL function "plan" statement 1
-- Should return an empty set as the table has no configuration
SELECT target, invocation FROM plan('{public.dummy}');
 target | invocation 
--------+------------
(0 rows)


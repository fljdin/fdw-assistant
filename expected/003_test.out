-- Should return a single job for public.t1
SELECT target, invocation FROM plan('{public.t1}');
  target   |     invocation     
-----------+--------------------
 public.t1 | CALL fdw.copy(11);
(1 row)

SELECT stage_id, job_id, target, part, lastseq, rows, state
  FROM job WHERE stage_id = 3;
 stage_id | job_id |  target   | part | lastseq | rows |  state  
----------+--------+-----------+------+---------+------+---------
        3 |     11 | public.t1 |    0 |       0 |    0 | pending
(1 row)

-- Should return all jobs
SELECT target, invocation FROM plan();
  target   |     invocation     
-----------+--------------------
 public.t2 | CALL fdw.copy(12);
 public.t2 | CALL fdw.copy(13);
 public.t1 | CALL fdw.copy(14);
 public.t3 | CALL fdw.copy(15);
 public.t3 | CALL fdw.copy(16);
(5 rows)

SELECT stage_id, job_id, target, part, lastseq, rows, state
  FROM job WHERE stage_id = 4;
 stage_id | job_id |  target   | part | lastseq | rows |  state  
----------+--------+-----------+------+---------+------+---------
        4 |     12 | public.t2 |    0 |    2000 |    0 | pending
        4 |     13 | public.t2 |    1 |    1999 |    0 | pending
        4 |     14 | public.t1 |    0 |       0 |    0 | pending
        4 |     15 | public.t3 |    0 |       0 |    0 | pending
        4 |     16 | public.t3 |    1 |       0 |    0 | pending
(5 rows)

-- Should fail as the table does not exist
SELECT target, invocation FROM plan('{public.foo}');
ERROR:  relation "public.foo" does not exist
CONTEXT:  SQL function "plan" statement 1
-- Should return an empty set as the table has no configuration
SELECT target, invocation FROM plan('{public.dummy}');
 target | invocation 
--------+------------
(0 rows)

